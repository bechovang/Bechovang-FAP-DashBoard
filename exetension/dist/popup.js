(function(){const c=document.createElement("link").relList;if(c&&c.supports&&c.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))d(n);new MutationObserver(n=>{for(const r of n)if(r.type==="childList")for(const a of r.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&d(a)}).observe(document,{childList:!0,subtree:!0});function i(n){const r={};return n.integrity&&(r.integrity=n.integrity),n.referrerPolicy&&(r.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?r.credentials="include":n.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function d(n){if(n.ep)return;n.ep=!0;const r=i(n);fetch(n.href,r)}})();const o=document.getElementById("scrapeBtn"),s=document.getElementById("downloadAllBtn"),l=document.getElementById("downloadProfileBtn"),u=document.getElementById("downloadExamBtn"),m=document.getElementById("downloadCurriculumBtn"),g=document.getElementById("scrapeWeeklyScheduleBtn"),p=document.getElementById("scrapeExamScheduleBtn"),h=document.getElementById("scrapeGradesBtn"),f=document.getElementById("scrapeAttendanceBtn"),B=document.getElementById("scrapeCurrentPageBtn"),E=document.getElementById("scrapeScheduleJSONBtn"),S=document.getElementById("scrapeGradeJSONBtn"),y=document.getElementById("gradeUrlsInput"),t=document.getElementById("status");o.addEventListener("click",()=>{o.disabled=!0,t.textContent="Đang bắt đầu...",chrome.runtime.sendMessage({action:"startScraping"},e=>{chrome.runtime.lastError?(t.textContent=`Lỗi: ${chrome.runtime.lastError.message}`,o.disabled=!1):e&&e.status&&(t.textContent=e.status)})});s.addEventListener("click",()=>{chrome.runtime.sendMessage({action:"downloadAll"})});l.addEventListener("click",()=>{chrome.runtime.sendMessage({action:"downloadProfile"})});u.addEventListener("click",()=>{chrome.runtime.sendMessage({action:"downloadExam"})});m.addEventListener("click",()=>{chrome.runtime.sendMessage({action:"downloadCurriculum"})});g.addEventListener("click",()=>{t.textContent="Đang mở trang lịch tuần...",chrome.runtime.sendMessage({action:"scrapeHTMLPage",pageType:"weekly-schedule"})});p.addEventListener("click",()=>{t.textContent="Đang mở trang lịch thi...",chrome.runtime.sendMessage({action:"scrapeHTMLPage",pageType:"exam-schedule"})});h.addEventListener("click",()=>{t.textContent="Đang mở trang điểm...",chrome.runtime.sendMessage({action:"scrapeHTMLPage",pageType:"student-grades"})});f.addEventListener("click",()=>{t.textContent="Đang mở trang điểm danh...",chrome.runtime.sendMessage({action:"scrapeHTMLPage",pageType:"attendance-report"})});B.addEventListener("click",()=>{t.textContent="Đang cào trang hiện tại...",chrome.runtime.sendMessage({action:"scrapeCurrentPage"})});E.addEventListener("click",()=>{t.textContent="Đang mở trang lịch tuần để cào JSON...",chrome.runtime.sendMessage({action:"scrapeScheduleJSON"})});S.addEventListener("click",()=>{const e=y.value.trim().split(`
`).filter(c=>c.trim()!=="");if(e.length===0){t.textContent="Vui lòng nhập ít nhất một link môn học!";return}t.textContent=`Đang cào điểm từ ${e.length} môn học...`,chrome.runtime.sendMessage({action:"scrapeGradeJSON",urls:e})});chrome.runtime.onMessage.addListener((e,c,i)=>{e.action==="updateStatus"?t.textContent=e.data:e.action==="scrapingComplete"?(t.textContent="Đã cào dữ liệu thành công!",s.disabled=!1,l.disabled=!1,u.disabled=!1,m.disabled=!1,o.disabled=!1):e.action==="htmlScrapingComplete"?t.textContent=`Đã cào HTML thành công! File: ${e.fileName}`:e.action==="htmlScrapingError"?t.textContent=`Lỗi cào HTML: ${e.error}`:e.action==="scheduleJSONScrapingComplete"?t.textContent=`Đã cào JSON lịch học thành công! File: ${e.fileName}`:e.action==="scheduleJSONScrapingError"?t.textContent=`Lỗi cào JSON lịch học: ${e.error}`:e.action==="gradeJSONScrapingComplete"?t.textContent="Đã cào JSON điểm thành công! File tổng hợp đã được tải xuống.":e.action==="gradeJSONScrapingError"?t.textContent=`Lỗi cào JSON điểm: ${e.error}`:e.action==="gradeJSONScrapingProgress"&&(t.textContent=`Đang cào điểm... (${e.current}/${e.total})`)});
