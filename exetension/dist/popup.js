(function(){const r=document.createElement("link").relList;if(r&&r.supports&&r.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))d(n);new MutationObserver(n=>{for(const c of n)if(c.type==="childList")for(const a of c.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&d(a)}).observe(document,{childList:!0,subtree:!0});function i(n){const c={};return n.integrity&&(c.integrity=n.integrity),n.referrerPolicy&&(c.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?c.credentials="include":n.crossOrigin==="anonymous"?c.credentials="omit":c.credentials="same-origin",c}function d(n){if(n.ep)return;n.ep=!0;const c=i(n);fetch(n.href,c)}})();const o=document.getElementById("scrapeBtn"),l=document.getElementById("downloadAllBtn"),s=document.getElementById("downloadProfileBtn"),u=document.getElementById("downloadExamBtn"),m=document.getElementById("downloadCurriculumBtn"),g=document.getElementById("scrapeWeeklyScheduleBtn"),p=document.getElementById("scrapeExamScheduleBtn"),h=document.getElementById("scrapeGradesBtn"),f=document.getElementById("scrapeAttendanceBtn"),S=document.getElementById("scrapeCurrentPageBtn"),B=document.getElementById("scrapeScheduleJSONBtn"),E=document.getElementById("scrapeGradeJSONBtn"),C=document.getElementById("gradeUrlsInput"),x=document.getElementById("scrapeAttendanceJSONBtn"),y=document.getElementById("attendanceUrlsInput"),t=document.getElementById("status");o.addEventListener("click",()=>{o.disabled=!0,t.textContent="Đang bắt đầu...",chrome.runtime.sendMessage({action:"startScraping"},e=>{chrome.runtime.lastError?(t.textContent=`Lỗi: ${chrome.runtime.lastError.message}`,o.disabled=!1):e&&e.status&&(t.textContent=e.status)})});l.addEventListener("click",()=>{chrome.runtime.sendMessage({action:"downloadAll"})});s.addEventListener("click",()=>{chrome.runtime.sendMessage({action:"downloadProfile"})});u.addEventListener("click",()=>{chrome.runtime.sendMessage({action:"downloadExam"})});m.addEventListener("click",()=>{chrome.runtime.sendMessage({action:"downloadCurriculum"})});g?.addEventListener("click",()=>{t.textContent="Đang mở trang lịch tuần...",chrome.runtime.sendMessage({action:"scrapeHTMLPage",pageType:"weekly-schedule"})});p?.addEventListener("click",()=>{t.textContent="Đang mở trang lịch thi...",chrome.runtime.sendMessage({action:"scrapeHTMLPage",pageType:"exam-schedule"})});h?.addEventListener("click",()=>{t.textContent="Đang mở trang điểm...",chrome.runtime.sendMessage({action:"scrapeHTMLPage",pageType:"student-grades"})});f?.addEventListener("click",()=>{t.textContent="Đang mở trang điểm danh...",chrome.runtime.sendMessage({action:"scrapeHTMLPage",pageType:"attendance-report"})});S?.addEventListener("click",()=>{t.textContent="Đang cào trang hiện tại...",chrome.runtime.sendMessage({action:"scrapeCurrentPage"})});B.addEventListener("click",()=>{t.textContent="Đang mở trang lịch tuần để cào JSON...",chrome.runtime.sendMessage({action:"scrapeScheduleJSON"})});E.addEventListener("click",()=>{const e=C.value.trim().split(`
`).filter(r=>r.trim()!=="");if(e.length===0){t.textContent="Vui lòng nhập ít nhất một link môn học!";return}t.textContent=`Đang cào điểm từ ${e.length} môn học...`,chrome.runtime.sendMessage({action:"scrapeGradeJSON",urls:e})});x.addEventListener("click",()=>{const e=y.value.trim().split(`
`).filter(r=>r.trim()!=="");if(e.length===0){t.textContent="Vui lòng nhập ít nhất một link điểm danh!";return}t.textContent=`Đang cào điểm danh từ ${e.length} môn học...`,chrome.runtime.sendMessage({action:"scrapeAttendanceJSON",urls:e})});chrome.runtime.onMessage.addListener((e,r,i)=>{e.action==="updateStatus"?t.textContent=e.data:e.action==="scrapingComplete"?(t.textContent="Đã cào dữ liệu thành công!",l.disabled=!1,s.disabled=!1,u.disabled=!1,m.disabled=!1,o.disabled=!1):e.action==="htmlScrapingComplete"?t.textContent=`Đã cào HTML thành công! File: ${e.fileName}`:e.action==="htmlScrapingError"?t.textContent=`Lỗi cào HTML: ${e.error}`:e.action==="scheduleJSONScrapingComplete"?t.textContent=`Đã cào JSON lịch học thành công! File: ${e.fileName}`:e.action==="scheduleJSONScrapingError"?t.textContent=`Lỗi cào JSON lịch học: ${e.error}`:e.action==="gradeJSONScrapingComplete"?t.textContent="Đã cào JSON điểm thành công! File tổng hợp đã được tải xuống.":e.action==="gradeJSONScrapingError"?t.textContent=`Lỗi cào JSON điểm: ${e.error}`:e.action==="gradeJSONScrapingProgress"?t.textContent=`Đang cào điểm... (${e.current}/${e.total})`:e.action==="attendanceJSONScrapingComplete"?t.textContent="Đã cào JSON điểm danh thành công! File tổng hợp đã được tải xuống.":e.action==="attendanceJSONScrapingError"?t.textContent=`Lỗi cào JSON điểm danh: ${e.error}`:e.action==="attendanceJSONScrapingProgress"&&(t.textContent=`Đang cào điểm danh... (${e.current}/${e.total})`)});
