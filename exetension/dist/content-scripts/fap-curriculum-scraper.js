function p(){console.log("FAP Curriculum Scraper: Bắt đầu cào dữ liệu chương trình học.");let c="UNKNOWN";const l=document.body.innerText.match(/Student\s+[^-]+-\s*([A-Z0-9_]+)/);l&&(c=l[1]),console.log("Mã chương trình học:",c);const e=[],a=document.querySelectorAll("tr");console.log("Tổng số hàng tr tìm thấy:",a.length),a.forEach(($,T)=>{const t=$.querySelectorAll("td");if(t.length===4){const i=t[0].innerText.trim(),n=t[1].innerText.trim(),s=t[2].innerText.trim(),r=t[3].innerText.trim();console.log(`Hàng ${T}: [${i}] [${n}] [${s}] [${r}]`);const m=parseInt(i,10),g=!isNaN(m)&&m>0,d=/^[A-Z]{2,4}\d{3}[a-z]?$/.test(n),h=/^-?\d+$/.test(r);if(g&&d&&s.length>0&&h){const o={termNo:parseInt(r,10),subjectCode:n,subjectName:s};e.push(o),console.log(`✓ Môn học hợp lệ ${e.length}: ${o.subjectCode} - ${o.subjectName} (Kỳ ${o.termNo})`)}else console.log(`✗ Bỏ qua hàng: STT=${g}, Code=${d}, Term=${h}`)}});const u={lastUpdated:new Date().toISOString(),programCode:c,subjects:e};return console.log(`FAP Curriculum Scraper: Cào xong ${e.length} môn học.`,u),u}const N=p();chrome.runtime.sendMessage({action:"scrapedCurriculumData",data:N});
