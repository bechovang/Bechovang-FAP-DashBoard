function u(){const t=window.location.href,e=document.title,n=new Date().toISOString();let c="unknown",r={};t.includes("ScheduleOfWeek.aspx")?(c="weekly-schedule",r=d()):t.includes("ScheduleExams.asp")?(c="exam-schedule",r=i()):t.includes("StudentGrade.aspx")?(c="student-grades",r=m()):t.includes("ViewAttendstudent.aspx")&&(c="attendance-report",r=p());const o=document.documentElement.outerHTML,s={url:t,pageTitle:e,timestamp:n,pageType:c,htmlContent:o,metadata:r};return console.log(`HTML Scraper: Đã cào trang ${c}`,s),s}function d(){const t={},e=document.querySelector("#ctl00_mainContent_drpYear"),n=document.querySelector("#ctl00_mainContent_drpSelectWeek");e&&(t.selectedYear=e.value,t.selectedYearText=e.options[e.selectedIndex]?.text),n&&(t.selectedWeek=n.value,t.selectedWeekText=n.options[n.selectedIndex]?.text);const c=document.querySelector("#ctl00_mainContent_divNameDay"),r=document.querySelector("#ctl00_mainContent_divShowDate");if(c){const o=Array.from(c.querySelectorAll("th")).map(s=>s.textContent?.trim());t.dayNames=o}if(r){const o=Array.from(r.querySelectorAll("th")).map(s=>s.textContent?.trim());t.dayDates=o}return t}function i(){const t={},e=document.querySelector("#ctl00_mainContent_divContent table");if(e){const n=e.querySelectorAll("tr");t.totalExams=n.length-1}return t}function m(){const t={},e=new URLSearchParams(window.location.search);t.rollNumber=e.get("rollNumber"),t.term=e.get("term"),t.course=e.get("course");const n=document.querySelector(".course-name, h2, h3");return n&&(t.courseName=n.textContent?.trim()),t}function p(){const t={},e=new URLSearchParams(window.location.search);return t.studentId=e.get("id"),t.campus=e.get("campus"),t.term=e.get("term"),t.course=e.get("course"),t}function f(t,e){const n=new Date().toISOString().replace(/[:.]/g,"-");let c=`fap-${t}-${n}`;switch(t){case"weekly-schedule":e.selectedYearText&&e.selectedWeekText&&(c=`fap-schedule-${e.selectedYearText}-${e.selectedWeekText}-${n}`);break;case"exam-schedule":c=`fap-exam-schedule-${n}`;break;case"student-grades":e.rollNumber&&e.term&&e.course&&(c=`fap-grades-${e.rollNumber}-${e.term}-${e.course}-${n}`);break;case"attendance-report":e.studentId&&e.term&&e.course&&(c=`fap-attendance-${e.studentId}-term${e.term}-course${e.course}-${n}`);break}return c+".txt"}const a=u(),l=f(a.pageType,a.metadata),S=`=== FAP HTML SCRAPING RESULT ===
URL: ${a.url}
Page Title: ${a.pageTitle}
Page Type: ${a.pageType}
Timestamp: ${a.timestamp}
File Name: ${l}

=== METADATA ===
${JSON.stringify(a.metadata,null,2)}

=== HTML CONTENT ===
${a.htmlContent}
`;chrome.runtime.sendMessage({action:"scrapedHTMLData",data:{content:S,fileName:l,pageType:a.pageType,metadata:a.metadata}});
